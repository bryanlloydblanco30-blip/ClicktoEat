(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15248,e=>{"use strict";var t=e.i(12578),r=e.i(90258),s=e.i(58695);function o(){let e=(0,s.useSearchParams)(),[o,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),[i,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{let t=e.get("user");if(t)try{let e=JSON.parse(decodeURIComponent(t));if("staff"!==e.role){window.location.href="http://localhost:3000/login";return}localStorage.setItem("user",JSON.stringify(e)),d(e),c(e.food_partner)}catch(e){console.error("Error parsing user data:",e),window.location.href="http://localhost:3000/login"}else{let e=localStorage.getItem("user");if(!e){window.location.href="http://localhost:3000/login";return}try{let t=JSON.parse(e);if("staff"!==t.role){window.location.href="http://localhost:3000/login";return}d(t),c(t.food_partner)}catch(e){console.error("Auth error:",e),window.location.href="http://localhost:3000/login"}}},[e]);let c=async e=>{try{console.log("ðŸ” Loading orders for:",e);let t=`http://localhost:8000/api/partner/orders/?partner=${encodeURIComponent(e)}`;console.log("ðŸ“¡ Fetching from:",t);let r=await fetch(t);if(!r.ok)throw console.error("âŒ Backend error:",r.status,r.statusText),Error(`Backend returned ${r.status}`);let s=await r.json();if(console.log("ðŸ“¦ Backend response:",s),!s.orders||0===s.orders.length){console.log("â„¹ï¸ No orders found for this partner"),a([]),l(!1);return}let o=s.orders.map(e=>({id:e.id,name:e.customer_name,item:e.items.map(e=>e.name).join(", "),quantity:e.items.reduce((e,t)=>e+t.quantity,0),totalPrice:parseFloat(e.total),status:e.status}));console.log("âœ… Transformed orders:",o),a(o)}catch(e){console.error("âŒ Error loading orders:",e),console.log("âš ï¸ Using temporary test data"),a([{id:1,name:"John Santos",item:"Burger Meal",quantity:2,totalPrice:300,status:"pending"},{id:2,name:"Maria Cruz",item:"Spaghetti",quantity:1,totalPrice:150,status:"pending"},{id:3,name:"Alex Dela Vega",item:"Chicken Rice",quantity:3,totalPrice:450,status:"pending"}])}finally{l(!1)}},h=async(e,t,r)=>{try{console.log(`ðŸ”„ Updating order #${e} to ${t}`);let s=await fetch(`http://localhost:8000/api/partner/orders/${e}/status/`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(s.ok)console.log(`âœ… Order #${e} updated to ${t}`),a(s=>s.map(s=>s.id===e?{...s,status:t,rejectReason:r}:s));else{let e=await s.json();console.error("âŒ Backend error:",e),alert("Failed to update order status")}}catch(e){console.error("âŒ Error updating status:",e),alert("Failed to update order status")}};return n?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8 bg-white p-6 rounded-lg shadow",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Incoming Orders"}),i&&(0,t.jsxs)("p",{className:"text-gray-600 mt-2",children:[i.food_partner," â€¢ Staff: ",i.username]})]}),(0,t.jsx)("button",{onClick:()=>{console.log("ðŸ‘‹ Logging out..."),localStorage.removeItem("user"),localStorage.removeItem("food_partner"),window.location.href="http://localhost:3000/login"},className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition",children:"Logout"})]}),0===o.length?(0,t.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[(0,t.jsxs)("p",{className:"text-gray-500 text-lg",children:["No orders yet for ",i?.food_partner]}),(0,t.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Orders will appear here when customers place them"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>(0,t.jsxs)("div",{className:"bg-white shadow-xl border rounded-2xl p-6 space-y-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-semibold",children:["Order #",e.id]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",e.id]}),(0,t.jsxs)("p",{className:"text-lg",children:[(0,t.jsx)("strong",{children:"Name:"})," ",e.name]}),(0,t.jsxs)("p",{className:"text-lg",children:[(0,t.jsx)("strong",{children:"Item:"})," ",e.item]}),(0,t.jsxs)("p",{className:"text-lg",children:[(0,t.jsx)("strong",{children:"Quantity:"})," ",e.quantity]}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["Total Price: â‚±",e.totalPrice]}),(0,t.jsxs)("p",{className:"text-sm font-medium",children:["Status: ",(0,t.jsx)("span",{className:"text-orange-600 font-bold",children:e.status.toUpperCase()})]}),"pending"===e.status&&(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)("button",{className:"flex-1 border-2 border-green-600 text-green-600 px-4 py-2 rounded-lg hover:bg-green-600 hover:text-white transition font-semibold",onClick:()=>h(e.id,"confirmed"),children:"Accept"}),(0,t.jsx)("button",{className:"flex-1 border-2 border-red-600 text-red-600 px-4 py-2 rounded-lg hover:bg-red-600 hover:text-white transition font-semibold",onClick:()=>{var t;let r;return t=e.id,void((r=prompt(`Please enter the reason for cancelling Order #${t}:`))&&""!==r.trim()?h(t,"cancelled",r):alert("Cancellation reason is required!"))},children:"Cancel"})]}),"confirmed"===e.status&&(0,t.jsx)("button",{className:"w-full border-2 border-green-600 text-green-600 px-4 py-2 rounded-lg hover:bg-green-600 hover:text-white transition font-semibold",onClick:()=>h(e.id,"preparing"),children:"Start Preparing"}),"preparing"===e.status&&(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)("button",{className:"flex-1 border-2 border-green-600 text-green-600 px-4 py-2 rounded-lg hover:bg-green-600 hover:text-white transition font-semibold",onClick:()=>h(e.id,"ready"),children:"Ready for Pickup"}),(0,t.jsx)("button",{className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition font-semibold",onClick:()=>h(e.id,"cancelled"),children:"Cancel"})]}),"ready"===e.status&&(0,t.jsx)("button",{className:"w-full border-2 border-green-600 text-green-600 px-4 py-2 rounded-lg hover:bg-green-600 hover:text-white transition font-semibold",onClick:()=>h(e.id,"completed"),children:"Mark as Completed"}),"completed"===e.status&&(0,t.jsx)("p",{className:"text-green-600 font-semibold text-center py-2",children:"âœ… Completed"}),"cancelled"===e.status&&(0,t.jsxs)("div",{className:"space-y-1 bg-red-50 p-3 rounded",children:[(0,t.jsx)("p",{className:"text-red-600 font-semibold",children:"âŒ Cancelled"}),e.rejectReason&&(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["Reason: ",e.rejectReason]})]})]},e.id))})]})}function a(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}),children:(0,t.jsx)(o,{})})}e.s(["default",()=>a])}]);